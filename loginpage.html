<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - AnimateItNow</title>
  <link rel="icon" href="favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="signup.css">
  
  <style>
    /* Accessibility improvements */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Focus styles for better accessibility */
    input:focus, button:focus, a:focus {
      outline: 2px solid #4f46e5;
      outline-offset: 2px;
    }
    
    /* Loading state */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    /* Error states */
    .error-message {
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
      display: none;
    }
    
    .input-error {
      border-color: #dc2626 !important;
    }
    
    /* Success states */
    .input-success {
      border-color: #16a34a !important;
    }
    
    /* Debug info (development only) */
    .debug-info {
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      padding: 0.75rem;
      margin: 1rem 0;
      font-size: 0.75rem;
      color: #6b7280;
      display: none;
    }
  </style>
</head>
<body>
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="logo" role="banner">AnimateItNow</div>
    <ul class="nav-links" role="menubar">
      <li role="none"><a href="index.html" role="menuitem">Home</a></li>
      <li role="none"><a href="signup.html" role="menuitem">Sign Up</a></li>
    </ul>
  </nav>

  <main class="form-container" role="main">
    <h1>Login</h1>
    <p class="subtitle">Welcome back! Please log in to continue.</p>

    <form id="loginForm" role="form" aria-labelledby="loginHeading">
      <div class="visually-hidden" id="loginHeading">Login Form</div>
      
      <div class="input-group">
        <label for="email" class="visually-hidden">Email Address</label>
        <input 
          type="email" 
          id="email"
          name="email"
          placeholder="Email Address" 
          required
          aria-required="true"
          aria-describedby="emailError"
          autocomplete="email"
        >
        <div id="emailError" class="error-message" role="alert" aria-live="polite"></div>
      </div>

      <div class="input-group">
        <label for="password" class="visually-hidden">Password</label>
        <input 
          type="password" 
          id="password"
          name="password"
          placeholder="Password" 
          required
          aria-required="true"
          aria-describedby="passwordError"
          autocomplete="current-password"
        >
        <div id="passwordError" class="error-message" role="alert" aria-live="polite"></div>
      </div>

      <button type="submit" class="btn" id="loginButton" aria-label="Login to your account">
        <span id="buttonText">Login</span>
        <span id="buttonSpinner" style="display: none;">â³</span>
      </button>
    </form>

    <p class="switch">Don't have an account? <a href="signup.html" aria-label="Navigate to sign up page">Sign up here</a></p>

  </main>

  <script>
    // ğŸ¯ Debug logging helper
    const logDebug = (message, data = null) => {
      console.log(`ğŸ” LoginDebug: ${message}`, data ? data : '');
      
      // Update debug info in development
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        const debugInfo = document.getElementById('debugInfo');
        const debugStatus = document.getElementById('debugStatus');
        if (debugInfo && debugStatus) {
          debugInfo.style.display = 'block';
          debugStatus.textContent = message;
        }
      }
    };

    // ğŸ¯ Performance monitoring helper
    const trackPerformance = (operation, startTime) => {
      const duration = performance.now() - startTime;
      logDebug(`â±ï¸ ${operation} Performance`, { duration: `${duration.toFixed(2)}ms` });
      return duration;
    };

    // ğŸ¯ Security monitoring
    const securityMonitor = {
      loginAttempts: 0,
      lastAttempt: null,
      maxAttempts: 5,
      
      trackAttempt: function() {
        this.loginAttempts++;
        this.lastAttempt = new Date();
        logDebug('ğŸ”’ Login attempt tracked', {
          attemptNumber: this.loginAttempts,
          timestamp: this.lastAttempt.toISOString()
        });
        
        if (this.loginAttempts >= this.maxAttempts) {
          logDebug('ğŸš¨ Maximum login attempts reached', {
            attempts: this.loginAttempts,
            limit: this.maxAttempts
          });
        }
      },
      
      resetAttempts: function() {
        this.loginAttempts = 0;
        this.lastAttempt = null;
        logDebug('ğŸ”„ Login attempts reset');
      },
      
      isRateLimited: function() {
        return this.loginAttempts >= this.maxAttempts;
      }
    };

    // ğŸ¯ Form validation
    const formValidator = {
      email: function(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const isValid = emailRegex.test(email);
        
        logDebug('ğŸ“§ Email validation', {
          email: email.substring(0, 3) + '...', // Partial logging for privacy
          isValid: isValid
        });
        
        return isValid;
      },
      
      password: function(password) {
        const isValid = password.length >= 6;
        
        logDebug('ğŸ”‘ Password validation', {
          length: password.length,
          isValid: isValid
        });
        
        return isValid;
      },
      
      showError: function(fieldId, message) {
        const field = document.getElementById(fieldId);
        const errorElement = document.getElementById(fieldId + 'Error');
        
        if (field && errorElement) {
          field.classList.add('input-error');
          field.classList.remove('input-success');
          errorElement.textContent = message;
          errorElement.style.display = 'block';
          
          logDebug('âŒ Field error shown', { field: fieldId, message: message });
        }
      },
      
      showSuccess: function(fieldId) {
        const field = document.getElementById(fieldId);
        const errorElement = document.getElementById(fieldId + 'Error');
        
        if (field && errorElement) {
          field.classList.remove('input-error');
          field.classList.add('input-success');
          errorElement.style.display = 'none';
          
          logDebug('âœ… Field validation passed', { field: fieldId });
        }
      },
      
      clearErrors: function() {
        const errorElements = document.querySelectorAll('.error-message');
        const inputFields = document.querySelectorAll('input');
        
        errorElements.forEach(el => {
          el.style.display = 'none';
          el.textContent = '';
        });
        
        inputFields.forEach(field => {
          field.classList.remove('input-error', 'input-success');
        });
        
        logDebug('ğŸ§¹ All form errors cleared');
      }
    };

    // ğŸ¯ Page initialization
    document.addEventListener('DOMContentLoaded', function() {
      const loadStartTime = performance.now();
      logDebug('ğŸš€ Login page initialized');
      
      const form = document.getElementById('loginForm');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const loginButton = document.getElementById('loginButton');
      const buttonText = document.getElementById('buttonText');
      const buttonSpinner = document.getElementById('buttonSpinner');

      // Track page load performance
      window.addEventListener('load', () => {
        const loadDuration = trackPerformance('Page Load', loadStartTime);
        logDebug('âœ… Page fully loaded', { loadTime: `${loadDuration.toFixed(2)}ms` });
      });

      // ğŸ¯ Real-time validation
      emailInput.addEventListener('blur', function() {
        if (this.value.trim()) {
          if (formValidator.email(this.value)) {
            formValidator.showSuccess('email');
          } else {
            formValidator.showError('email', 'Please enter a valid email address');
          }
        }
      });

      passwordInput.addEventListener('blur', function() {
        if (this.value.trim()) {
          if (formValidator.password(this.value)) {
            formValidator.showSuccess('password');
          } else {
            formValidator.showError('password', 'Password must be at least 6 characters');
          }
        }
      });

      // ğŸ¯ Form submission handler
      form.addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const submitStartTime = performance.now();
        logDebug('ğŸ¯ Form submission started');
        
        // Clear previous errors
        formValidator.clearErrors();
        
        // Get form data
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        
        // Validate form
        let isValid = true;
        
        if (!email) {
          formValidator.showError('email', 'Email is required');
          isValid = false;
        } else if (!formValidator.email(email)) {
          formValidator.showError('email', 'Please enter a valid email address');
          isValid = false;
        }
        
        if (!password) {
          formValidator.showError('password', 'Password is required');
          isValid = false;
        } else if (!formValidator.password(password)) {
          formValidator.showError('password', 'Password must be at least 6 characters');
          isValid = false;
        }
        
        if (!isValid) {
          logDebug('âŒ Form validation failed', { email: !!email, password: !!password });
          return;
        }
        
        // Check rate limiting
        if (securityMonitor.isRateLimited()) {
          formValidator.showError('password', 'Too many login attempts. Please try again later.');
          logDebug('ğŸš¨ Rate limiting applied', { attempts: securityMonitor.loginAttempts });
          return;
        }
        
        // Track login attempt
        securityMonitor.trackAttempt();
        
        // Show loading state
        loginButton.disabled = true;
        loginButton.classList.add('loading');
        buttonText.style.display = 'none';
        buttonSpinner.style.display = 'inline';
        
        logDebug('â³ Authentication in progress', {
          email: email.substring(0, 3) + '...', // Privacy-conscious logging
          attempt: securityMonitor.loginAttempts
        });
        
        try {
          // Simulate API call (replace with actual authentication)
          await new Promise(resolve => setTimeout(resolve, 1500));
          
          const submitDuration = trackPerformance('Form Submission', submitStartTime);
          
          // Simulate successful login (replace with actual success handling)
          logDebug('âœ… Login successful', {
            duration: `${submitDuration.toFixed(2)}ms`,
            attempts: securityMonitor.loginAttempts
          });
          
          // Reset attempts on success
          securityMonitor.resetAttempts();
          
          // Show success message (replace with actual redirect)
          alert('Login successful! Redirecting...');
          
          // Simulate redirect (replace with actual navigation)
          setTimeout(() => {
            window.location.href = 'dashboard.html';
          }, 1000);
          
        } catch (error) {
          const submitDuration = trackPerformance('Form Submission', submitStartTime);
          
          logDebug('âŒ Login failed', {
            error: error.message,
            duration: `${submitDuration.toFixed(2)}ms`,
            attempts: securityMonitor.loginAttempts
          });
          
          formValidator.showError('password', 'Invalid email or password. Please try again.');
        } finally {
          // Reset loading state
          loginButton.disabled = false;
          loginButton.classList.remove('loading');
          buttonText.style.display = 'inline';
          buttonSpinner.style.display = 'none';
        }
      });

      // ğŸ¯ Keyboard navigation enhancements
      document.addEventListener('keydown', function(event) {
        // Escape key to clear form
        if (event.key === 'Escape') {
          form.reset();
          formValidator.clearErrors();
          logDebug('âŒ¨ï¸ Form cleared with Escape key');
        }
        
        // Ctrl+Enter to submit form
        if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
          event.preventDefault();
          form.dispatchEvent(new Event('submit'));
          logDebug('âŒ¨ï¸ Form submitted with Ctrl+Enter');
        }
      });

      // ğŸ¯ Input field tracking for analytics
      const inputs = document.querySelectorAll('input');
      inputs.forEach(input => {
        input.addEventListener('focus', function() {
          logDebug('ğŸ¯ Field focused', { field: this.id });
        });
        
        input.addEventListener('input', function() {
          logDebug('ğŸ“ Field input', { 
            field: this.id, 
            valueLength: this.value.length,
            hasValue: !!this.value.trim()
          });
        });
      });

      logDebug('ğŸ”§ Event listeners initialized');
    });

    // ğŸ¯ Error boundary for unhandled errors
    window.addEventListener('error', function(event) {
      logDebug('ğŸš¨ Unhandled error', {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno
      });
    });

    // ğŸ¯ Page visibility tracking
    document.addEventListener('visibilitychange', function() {
      logDebug('ğŸ‘€ Page visibility changed', { 
        hidden: document.hidden,
        visibilityState: document.visibilityState
      });
    });
  </script>
</body>
</html>